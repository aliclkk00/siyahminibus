<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siyah MinibÃ¼s DerneÄŸi - hizliyimSystems</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- GENEL STÄ°LLER --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #050505;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* Arka plan biraz daha derinlikli olsun */
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #000000 100%);
            padding: 20px;
            overflow-x: hidden; /* YanÄ±p sÃ¶nmeler taÅŸmasÄ±n */
        }

        /* --- FLASH / PATLAMA EFEKTÄ° --- */
        .flash-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #ffffff;
            opacity: 0;
            pointer-events: none; /* TÄ±klamayÄ± engellemesin */
            z-index: 1; /* Konteynerin arkasÄ±nda kalsÄ±n */
            mix-blend-mode: overlay;
            transition: opacity 0.05s ease-out; /* Ã‡ok hÄ±zlÄ± yanÄ±p sÃ¶nme iÃ§in */
        }

        /* --- ANA KONTEYNER --- */
        .container {
            width: 100%;
            max-width: 600px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            padding: 30px;
            text-align: center;
            z-index: 10; /* Flash'Ä±n Ã¼stÃ¼nde kalsÄ±n */
        }

        /* Ãœst Ã‡izgi (BEYAZ OLDU) */
        .container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 4px;
            /* KÄ±rmÄ±zÄ± yerine Beyaz Gradient */
            background: linear-gradient(90deg, transparent, #ffffff, transparent);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        h1 {
            font-size: 24px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 2px; margin-bottom: 10px;
            background: -webkit-linear-gradient(#fff, #888);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* --- BÄ°Z KÄ°MÄ°Z BUTONU VE MODAL --- */
        .who-we-are-btn {
            background: transparent; border: 1px solid #333; color: #888;
            padding: 8px 15px; font-size: 0.8rem; border-radius: 20px;
            cursor: pointer; margin-bottom: 25px; transition: 0.3s;
        }
        .who-we-are-btn:hover { border-color: #ffffff; color: #fff; }

        .info-box {
            display: none;
            background: #111; padding: 20px; border-radius: 10px;
            border-left: 3px solid #ffffff; /* BurasÄ± da beyaz uyumlu olsun */
            text-align: left; margin-bottom: 25px;
        }
        .info-box h3 { color: #ffffff; font-size: 1rem; margin-bottom: 10px; }
        .info-box p { font-size: 0.85rem; color: #ccc; line-height: 1.5; margin-bottom: 10px; }
        .info-box .tiny-text { font-size: 0.6rem; color: #555; margin-top: 15px; font-style: italic; }

        /* --- FORMLAR --- */
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; font-size: 0.75rem; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; margin-left: 5px; }
        
        input, textarea {
            width: 100%; padding: 12px; background: #0a0a0a;
            border: 1px solid #333; border-radius: 8px; color: #fff;
            font-family: 'Montserrat', sans-serif; font-size: 0.9rem;
            transition: 0.3s; outline: none;
        }
        input:focus, textarea:focus { border-color: #ffffff; background: #111; }

        button.action-btn {
            width: 100%; padding: 14px; background: #fff; color: #000;
            border: none; border-radius: 8px; font-weight: 800;
            text-transform: uppercase; cursor: pointer; transition: 0.3s;
            margin-top: 10px;
        }
        button.action-btn:hover { background: #ccc; transform: translateY(-2px); }
        button.action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- BÃ–LÃœM AYIRACI --- */
        .divider {
            margin: 30px 0; height: 1px; background: #222; position: relative;
        }
        .divider span {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            background: #151515; padding: 0 10px; color: #444; font-size: 0.8rem;
        }

        /* --- SONUÃ‡ ALANLARI --- */
        #codeResult {
            display: none; margin-top: 20px; padding: 15px;
            background: rgba(255, 255, 255, 0.05); border: 1px solid #ffffff;
            color: #ffffff; border-radius: 8px; font-weight: 600;
        }
        .unique-code { font-size: 1.5rem; letter-spacing: 3px; display: block; margin-top: 5px; color: #fff; margin-bottom: 10px; }
        
        /* Kopyala Butonu */
        .copy-btn {
            background: #333; color: #fff; border: 1px solid #555;
            padding: 8px 16px; border-radius: 5px; cursor: pointer;
            font-size: 0.75rem; text-transform: uppercase; font-weight: 600;
            transition: 0.2s; display: inline-flex; align-items: center; gap: 5px;
        }
        .copy-btn:hover { background: #fff; color: #000; }
        .copy-btn:active { transform: scale(0.95); }

        /* --- ADMIN & DURUM PANELÄ° --- */
        #adminPanel, #statusResult { display: none; margin-top: 20px; text-align: left; }
        
        .message-card {
            background: #111; border: 1px solid #333; padding: 15px;
            border-radius: 10px; margin-bottom: 15px; position: relative;
        }
        .message-card h4 { color: #fff; font-size: 0.9rem; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .message-card .meta { font-size: 0.7rem; color: #555; margin-bottom: 10px; }
        .message-card .msg-body { font-size: 0.9rem; color: #ddd; background: #050505; padding: 10px; border-radius: 5px; }
        .message-card .reply-section { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #333; }
        .message-card .admin-reply { color: #ffffff; font-size: 0.85rem; font-weight: bold; }
        
        .admin-controls { margin-top: 10px; display: flex; gap: 10px; }
        .btn-reply { background: #222; color: #fff; border: 1px solid #444; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; flex: 1; }
        .btn-delete { background: #300; color: #f55; border: 1px solid #500; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .btn-reply:hover { background: #333; }
        .btn-delete:hover { background: #500; color: #fff; }

        .status-badge {
            display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.6rem; text-transform: uppercase;
        }
        .status-pending { background: #333; color: #aaa; }
        .status-replied { background: #fff; color: #000; font-weight: bold; }

        .reply-box { display: none; margin-top: 10px; }
    </style>
</head>
<body>

    <!-- Arka plan patlama efekti iÃ§in katman -->
    <div class="flash-overlay" id="flashOverlay"></div>

    <div class="container">
        <h1>Siyah MinibÃ¼s DerneÄŸi</h1>
        <button class="who-we-are-btn" onclick="toggleInfo()">Biz Kimiz?</button>

        <!-- BÄ°Z KÄ°MÄ°Z TEXT ALANI -->
        <div id="infoBox" class="info-box">
            <h3>MÄ°SYONUMUZ</h3>
            <p>
                Siyah MinibÃ¼s Åirketi ve Dernekleri, kurucu Ã¶nderimiz <strong>H.T.</strong> tarafÄ±ndan kurulmuÅŸtur.
                Misyonumuz, sizlere birbirinden gÃ¼zel seÃ§eneklerle sizleri daha "konforlu" (ve biraz daha hÄ±zlÄ±) bir hayata hazÄ±rlamaktÄ±r.
            </p>
            <p style="color: #ffffff; font-weight: 600; text-decoration: underline;">
                Sizin seÃ§eceÄŸiniz seÃ§eneklerden birini seÃ§mek zorunludur. Aksi takdirde iki seÃ§eneÄŸi aynÄ± anda seÃ§miÅŸ olacaksÄ±nÄ±z.
            </p>
            <p class="tiny-text">
                * SeÃ§eneklerimizin gÃ¼venli seÃ§tirilebilmesi iÃ§in ÅŸÃ¶fÃ¶rÃ¼mÃ¼z <strong>A.Ã‡.</strong> ve bazÄ± "Ã¶zel elemanlar" tarafÄ±ndan alÄ±nÄ±p sakinleÅŸtirildikten sonra, tamamen kendi rÄ±zanÄ±zla seÃ§ebileceÄŸiniz ama mutlaka bir seÃ§im yapmak zorunda olduÄŸunuz sorular sorulacaktÄ±r. Tabii ki gÃ¼venliÄŸiniz bizim elimizde.
            </p>
        </div>

        <!-- MESAJ OLUÅTURMA ALANI -->
        <div id="createSection">
            <div class="input-group">
                <label>Ä°sim Soyisim</label>
                <input type="text" id="senderName" placeholder="AdÄ±nÄ±z...">
            </div>
            <div class="input-group">
                <label>MesajÄ±nÄ±z</label>
                <textarea id="senderMessage" rows="3" placeholder="DerneÄŸimize iletmek istediÄŸiniz konu..."></textarea>
            </div>
            <button class="action-btn" onclick="sendMessage()">Mesaj Kodumu OluÅŸtur</button>

            <div id="codeResult">
                MesajÄ±nÄ±z baÅŸarÄ±yla iletildi.<br>
                Sorgulama Kodunuz:
                <span class="unique-code" id="displayCode">---</span>
                <button class="copy-btn" onclick="copyCode()">
                    ğŸ“‹ KODU KOPYALA
                </button>
                <div style="font-size: 0.7rem; color: #aaa; margin-top:10px;">(Bu kodu kaybetmeyin!)</div>
            </div>
        </div>

        <div class="divider"><span>VEYA</span></div>

        <!-- SORGULAMA VE GÄ°RÄ°Å ALANI -->
        <div id="checkSection">
            <div class="input-group">
                <label>Mesaj Durumu / Personel GiriÅŸi</label>
                <input type="text" id="queryCode" placeholder="Kodunuzu giriniz (Ã–rn: #AB123)...">
            </div>
            <button class="action-btn" style="background: #222; color: #fff; border: 1px solid #444;" onclick="checkStatus()">Sorgula / GiriÅŸ</button>
        </div>

        <!-- SONUÃ‡LAR VE ADMÄ°N PANELÄ° BURAYA GELECEK -->
        <div id="statusResult"></div>
        <div id="adminPanel"></div>

    </div>

    <!-- FIREBASE IMPORT VE LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, updateDoc, doc, deleteDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4FbJfLXNj9-XgSr2_jTMPCfydaK7bo9s",
            authDomain: "siyahminibus.firebaseapp.com",
            projectId: "siyahminibus",
            storageBucket: "siyahminibus.firebasestorage.app",
            messagingSenderId: "126407389376",
            appId: "1:126407389376:web:ea5ba72ec5a48aec903d25"
        };

        // Firebase BaÅŸlat
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- GLOBAL DEÄÄ°ÅKENLER ---
        window.currentRole = 'user'; // 'user', 'admin' (Hasan), 'superadmin' (Irem)

        // --- EFEKT FONKSÄ°YONLARI ---
        
        // Rastgele Flash Efekti
        function triggerRandomFlash() {
            const flash = document.getElementById('flashOverlay');
            // Rastgele bir yoÄŸunluk seÃ§: Bazen Ã§ok parlak, bazen sÃ¶nÃ¼k
            const intensity = Math.random(); 
            let opacityValue = 0;

            if (intensity > 0.95) opacityValue = 0.8; // BÃ¼yÃ¼k patlama
            else if (intensity > 0.80) opacityValue = 0.4; // Orta silah
            else if (intensity > 0.50) opacityValue = 0.15; // Uzak Ä±ÅŸÄ±k
            
            if (opacityValue > 0) {
                flash.style.opacity = opacityValue;
                // Ã‡ok kÄ±sa sÃ¼rede sÃ¶ndÃ¼r (patlama hissi)
                setTimeout(() => {
                    flash.style.opacity = 0;
                }, 50 + Math.random() * 100);
            }

            // Bir sonraki patlama ne zaman? (Rastgele 1 sn ile 8 sn arasÄ±)
            const nextTime = 1000 + Math.random() * 7000;
            setTimeout(triggerRandomFlash, nextTime);
        }

        // Sayfa yÃ¼klendiÄŸinde efekti baÅŸlat
        triggerRandomFlash();


        // --- FONKSÄ°YONLAR ---

        // 1. Biz Kimiz AÃ§/Kapa
        window.toggleInfo = () => {
            const box = document.getElementById('infoBox');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

        // 2. Kopyalama Fonksiyonu
        window.copyCode = () => {
            const codeText = document.getElementById('displayCode').innerText;
            
            // Gizli bir textarea oluÅŸturup kopyalama yapalÄ±m (En gÃ¼venilir yÃ¶ntem)
            const tempInput = document.createElement("textarea");
            tempInput.value = codeText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            // Butonu geÃ§ici olarak gÃ¼ncelle
            const btn = document.querySelector('.copy-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = "âœ… KOPYALANDI!";
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        // 3. Rastgele Kod Ãœretici
        function generateUniqueCode() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let code = "#SMB-";
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // 4. Mesaj GÃ¶nderme
        window.sendMessage = async () => {
            const name = document.getElementById('senderName').value;
            const message = document.getElementById('senderMessage').value;
            
            if (!name || !message) {
                alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurunuz, yoksa Ã¶zel elemanlarÄ±mÄ±z devreye girer!");
                return;
            }

            const uniqueCode = generateUniqueCode();
            const btn = document.querySelector('#createSection .action-btn');
            
            btn.disabled = true;
            btn.innerText = "Sisteme Ä°ÅŸleniyor...";

            try {
                await addDoc(collection(db, "messages"), {
                    name: name,
                    message: message,
                    code: uniqueCode,
                    status: 'beklemede', // beklemede, cevaplandi
                    adminReply: "",
                    replyAuthor: "",
                    createdAt: serverTimestamp()
                });

                document.getElementById('codeResult').style.display = 'block';
                document.getElementById('displayCode').innerText = uniqueCode;
                document.getElementById('senderName').value = "";
                document.getElementById('senderMessage').value = "";
                btn.innerText = "Mesaj Kodumu OluÅŸtur";
                btn.disabled = false;

            } catch (e) {
                console.error("Hata: ", e);
                alert("Sistemde bir arÄ±za oluÅŸtu. Tekrar deneyiniz.");
                btn.disabled = false;
            }
        }

        // 5. Sorgulama ve GiriÅŸ MantÄ±ÄŸÄ±
        window.checkStatus = () => {
            const inputVal = document.getElementById('queryCode').value.trim();
            const adminPanel = document.getElementById('adminPanel');
            const statusResult = document.getElementById('statusResult');
            
            // Temizle
            adminPanel.innerHTML = "";
            statusResult.innerHTML = "";
            adminPanel.style.display = 'none';
            statusResult.style.display = 'none';

            if (inputVal === 'hasantrkz') {
                // HASAN GÄ°RÄ°ÅÄ°
                window.currentRole = 'admin';
                alert("HoÅŸgeldin YÃ¶netici Hasan. MesajlarÄ± gÃ¶rÃ¼ntÃ¼leyebilir ve cevaplayabilirsin.");
                loadAdminPanel();
            } else if (inputVal === 'iremsenicokseviyorum') {
                // Ä°REM GÄ°RÄ°ÅÄ° (SUPER ADMIN)
                window.currentRole = 'superadmin';
                alert("HoÅŸgeldin Alicimmmm (SÃ¼per YÃ¶netici). Tam yetki verildi. Silebilirsin.");
                loadAdminPanel();
            } else {
                // NORMAL KULLANICI SORGUSU
                window.currentRole = 'user';
                checkUserMessage(inputVal);
            }
        }

        // 6. KullanÄ±cÄ± Kendi MesajÄ±nÄ± Sorguluyor
        function checkUserMessage(code) {
            const statusResult = document.getElementById('statusResult');
            statusResult.style.display = 'block';
            statusResult.innerHTML = "<p style='color:#888;'>VeritabanÄ± taranÄ±yor...</p>";

            const q = query(collection(db, "messages"), where("code", "==", code));
            
            // Tek seferlik deÄŸil, canlÄ± dinleyelim ki cevap gelince gÃ¶rsÃ¼n
            onSnapshot(q, (querySnapshot) => {
                statusResult.innerHTML = ""; // Temizle
                if (querySnapshot.empty) {
                    statusResult.innerHTML = "<p style='color:red;'>BÃ¶yle bir kod bulunamadÄ±. YanlÄ±ÅŸ girmiÅŸ olabilir misiniz?</p>";
                } else {
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const statusClass = data.status === 'cevaplandi' ? 'status-replied' : 'status-pending';
                        const statusText = data.status === 'cevaplandi' ? 'YÃ–NETÄ°CÄ° CEVAPLADI' : 'YÃ–NETÄ°CÄ° ONAYI BEKLENÄ°YOR';
                        
                        let html = `
                            <div class="message-card" style="border-color: #ffffff;">
                                <h4>Mesaj Durumu: <span class="status-badge ${statusClass}">${statusText}</span></h4>
                                <div class="meta">GÃ¶nderen: ${data.name} | Tarih: ${data.createdAt ? new Date(data.createdAt.toDate()).toLocaleDateString() : 'Az Ã¶nce'}</div>
                                <div class="msg-body">${data.message}</div>
                        `;

                        if (data.status === 'cevaplandi') {
                            html += `
                                <div class="reply-section">
                                    <p class="admin-reply">
                                        <span style="color:#aaa;">${data.replyAuthor || 'YÃ¶netici'}:</span> 
                                        ${data.adminReply}
                                    </p>
                                </div>
                            `;
                        } else {
                            html += `<div style="margin-top:10px; font-size:0.8rem; color:#666;">MesajÄ±nÄ±z yÃ¶neticilerin ekranÄ±na dÃ¼ÅŸtÃ¼, lÃ¼tfen bekleyiniz...</div>`;
                        }

                        html += `</div>`;
                        statusResult.innerHTML = html;
                    });
                }
            });
        }

        // 7. YÃ¶netici Paneli YÃ¼kle
        function loadAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            adminPanel.style.display = 'block';
            adminPanel.innerHTML = "<h3>GELEN KUTUSU (CANLI)</h3><div id='msgList'>YÃ¼kleniyor...</div>";
            
            // TÃ¼m mesajlarÄ± tarihe gÃ¶re getir
            const q = query(collection(db, "messages"), orderBy("createdAt", "desc"));

            onSnapshot(q, (snapshot) => {
                const listDiv = document.getElementById('msgList');
                listDiv.innerHTML = "";
                
                if (snapshot.empty) {
                    listDiv.innerHTML = "<p>HenÃ¼z hiÃ§ mesaj yok.</p>";
                    return;
                }

                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const docId = docSnap.id;
                    const isReplied = data.status === 'cevaplandi';
                    
                    let cardHtml = `
                        <div class="message-card">
                            <h4>
                                ${data.name} <span style="font-size:0.7rem; color:#ffffff;">${data.code}</span>
                            </h4>
                            <div class="meta">${data.createdAt ? new Date(data.createdAt.toDate()).toLocaleString() : 'Yeni'}</div>
                            <div class="msg-body">${data.message}</div>
                    `;

                    // Cevap BÃ¶lÃ¼mÃ¼
                    if (isReplied) {
                        cardHtml += `
                            <div class="reply-section">
                                <p class="admin-reply">Cevap (${data.replyAuthor}): ${data.adminReply}</p>
                            </div>
                        `;
                    }

                    // Kontrol ButonlarÄ±
                    cardHtml += `<div class="admin-controls">`;
                    
                    // Herkes cevap verebilir
                    if (!isReplied || window.currentRole === 'superadmin') {
                         cardHtml += `<button class="btn-reply" onclick="openReplyBox('${docId}')">Cevapla</button>`;
                    }

                    // Sadece Super Admin (Irem) Silebilir
                    if (window.currentRole === 'superadmin') {
                        cardHtml += `<button class="btn-delete" onclick="deleteMessage('${docId}')">Sil ğŸ—‘ï¸</button>`;
                    }

                    cardHtml += `</div>`;

                    // Cevap Input AlanÄ± (Gizli)
                    cardHtml += `
                        <div id="replyBox-${docId}" class="reply-box">
                            <textarea id="text-${docId}" rows="2" placeholder="CevabÄ±nÄ±zÄ± yazÄ±n..." style="width:100%; margin-bottom:5px;"></textarea>
                            <button class="action-btn" style="font-size:0.8rem; padding:5px;" onclick="submitReply('${docId}')">GÃ–NDER</button>
                        </div>
                    `;

                    cardHtml += `</div>`;
                    listDiv.innerHTML += cardHtml;
                });
            });
        }

        // 8. Admin AksiyonlarÄ±
        window.openReplyBox = (id) => {
            const box = document.getElementById(`replyBox-${id}`);
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

        window.submitReply = async (docId) => {
            const replyText = document.getElementById(`text-${docId}`).value;
            if (!replyText) return;

            const authorName = window.currentRole === 'superadmin' ? 'A.Ã‡. (YÃ¶netici)' : 'H.T. (YÃ¶netici)';

            try {
                const docRef = doc(db, "messages", docId);
                await updateDoc(docRef, {
                    adminReply: replyText,
                    replyAuthor: authorName,
                    status: 'cevaplandi',
                    replyDate: serverTimestamp()
                });
                alert("Cevap gÃ¶nderildi!");
            } catch (e) {
                console.error("Cevap hatasÄ±:", e);
                alert("Hata oluÅŸtu.");
            }
        }

        window.deleteMessage = async (docId) => {
            if (!confirm("Bu mesajÄ± sonsuza kadar silmek istediÄŸine emin misin?")) return;

            try {
                await deleteDoc(doc(db, "messages", docId));
            } catch (e) {
                console.error("Silme hatasÄ±:", e);
                alert("Silerken hata oluÅŸtu.");
            }
        }

    </script>
</body>
</html>



